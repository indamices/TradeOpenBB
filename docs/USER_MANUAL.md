# TradeOpenBB 功能使用说明书

**版本**: 1.1  
**适用对象**: 测试工程师、内测用户  
**最后更新**: 2026-01-15

---

## 📋 目录

1. [系统概述](#系统概述)
2. [访问方式](#访问方式)
3. [主要功能模块](#主要功能模块)
4. [详细操作指南](#详细操作指南)
5. [测试要点](#测试要点)
6. [常见问题](#常见问题)

---

## 系统概述

TradeOpenBB 是一个基于 AI 的量化交易平台，提供以下核心功能：

- **投资组合管理**: 创建和管理投资组合，跟踪持仓和收益
- **AI 策略生成**: 使用 AI（Gemini/OpenAI/Claude）生成交易策略
- **策略管理**: 保存、编辑、启用/禁用交易策略
- **策略回测**: 使用历史数据测试策略表现
- **实时市场数据**: 获取股票报价、技术指标和市场概览
- **AI 聊天助手**: 与 AI 对话，获取策略建议和代码解释
- **交易订单**: 创建和管理交易订单（模拟交易）
- **股票池管理**: 创建和管理股票池，用于回测和筛选

---

## 访问方式

### 生产环境
- **前端地址**: https://tradeopenbb-frontend.onrender.com
- **后端 API**: https://tradeopenbb-backend.onrender.com
- **API 文档**: https://tradeopenbb-backend.onrender.com/docs

### 本地开发环境
- **前端地址**: http://localhost:3000
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/docs

---

## 主要功能模块

### 1. 数据可视化 (Dashboard)
**位置**: 左侧导航栏 → "数据可视化"（首页，默认显示）

**功能**:
- 查看投资组合总览（总资产、现金、盈亏）
- 查看持仓列表和实时价格
- 查看市场概览（多只股票报价）
- 查看技术指标图表（SMA、RSI、MACD）
- 查看收益趋势图
- 多视图切换（概览/多股票/技术指标）

### 2. 回测实验室 (Backtest Lab)
**位置**: 左侧导航栏 → "回测实验室"

**功能**:
- 选择策略进行回测
- 设置回测时间范围
- 选择股票池或手动输入股票代码
- 设置初始资金
- 查看回测结果（收益、夏普比率、最大回撤等）
- 查看回测图表（资产曲线、交易记录）
- 股票池管理（创建、编辑、删除股票池）

### 3. AI 策略助手 (AI Chat Assistant)
**位置**: 左侧导航栏 → "AI策略助手"

**功能**:
- 与 AI 进行对话，获取策略建议
- 创建和管理多个会话
- 从 AI 回复中自动提取策略代码
- 保存提取的策略到策略库
- 查看会话历史
- 策略代码自动识别和提取

### 4. 策略管理 (Strategy Manager)
**位置**: 左侧导航栏 → "策略管理"

**功能**:
- 查看所有已保存的策略
- 搜索和筛选策略（全部/激活/未激活）
- 编辑策略名称、描述、代码
- 启用/禁用策略
- 批量操作（批量启用/禁用）
- 删除策略
- 策略代码编辑和验证

### 5. 投资组合 (Portfolio)
**位置**: 左侧导航栏 → "投资组合"

**功能**:
- 查看投资组合详情（开发中）
- 高级分配设置（计划中）

### 6. AI 设置 (AI Model Settings)
**位置**: 左侧导航栏 → "AI设置"

**功能**:
- 添加、编辑、删除 AI 模型配置
- 支持 Gemini、OpenAI、Claude、Custom 四种提供商
- 测试模型连接
- 设置默认模型
- API Key 加密存储

---

## 详细操作指南

### 模块 1: AI 设置

#### 1.1 添加 AI 模型

**步骤**:
1. 点击左侧导航栏 "AI 模型设置"
2. 点击右上角 "添加模型" 按钮
3. 填写表单：
   - **名称**: 模型显示名称（如 "Gemini Pro"）
   - **提供商**: 选择 Gemini / OpenAI / Claude / Custom
   - **API Key**: 输入对应的 API 密钥
   - **模型名称**: 具体模型名称（如 "gemini-pro", "gpt-4"）
   - **Base URL**: 自定义模型需要填写（可选）
4. 点击 "保存"
5. 系统会自动加密保存 API Key

**测试要点**:
- ✅ 验证 API Key 格式是否正确
- ✅ 验证模型连接是否成功（点击 "测试连接"）
- ✅ 验证加密存储是否正常工作
- ✅ 验证错误提示是否友好

#### 1.2 测试模型连接

**步骤**:
1. 在模型列表中，找到要测试的模型
2. 点击模型卡片上的 "测试连接" 按钮（TestTube 图标）
3. 等待测试结果（通常 5-10 秒）
4. 查看测试结果：
   - ✅ 成功：显示 "连接成功"
   - ❌ 失败：显示错误信息

**测试要点**:
- ✅ 测试有效的 API Key
- ✅ 测试无效的 API Key（应显示错误）
- ✅ 测试网络连接问题
- ✅ 验证测试结果反馈是否及时

#### 1.3 设置默认模型

**步骤**:
1. 在模型列表中，找到要设为默认的模型
2. 点击模型卡片上的星标图标（⭐）
3. 模型会被标记为默认，其他模型自动取消默认

**测试要点**:
- ✅ 验证只能有一个默认模型
- ✅ 验证默认模型在策略生成时被优先使用

#### 1.4 编辑/删除模型

**步骤**:
1. 点击模型卡片上的 "编辑" 按钮（Edit 图标）
2. 修改信息后点击 "保存"
3. 或点击 "删除" 按钮（Trash 图标）删除模型

**测试要点**:
- ✅ 验证编辑后数据是否正确更新
- ✅ 验证删除确认提示
- ✅ 验证删除后列表是否正确刷新

---

### 模块 2: 策略管理

#### 2.1 查看策略列表

**步骤**:
1. 点击左侧导航栏 "策略管理"
2. 查看策略列表，每个策略显示：
   - 策略名称
   - 描述
   - 激活状态（绿色=激活，灰色=未激活）
   - 创建时间

**测试要点**:
- ✅ 验证策略列表是否正确加载
- ✅ 验证策略信息显示是否完整
- ✅ 验证空列表时的提示信息

#### 2.2 搜索和筛选策略

**步骤**:
1. 在搜索框中输入关键词（策略名称或描述）
2. 或使用筛选器：
   - "全部": 显示所有策略
   - "激活": 只显示激活的策略
   - "未激活": 只显示未激活的策略

**测试要点**:
- ✅ 验证搜索功能是否实时响应
- ✅ 验证筛选功能是否正确
- ✅ 验证搜索无结果时的提示

#### 2.3 编辑策略

**步骤**:
1. 点击策略卡片上的 "编辑" 按钮
2. 修改策略信息：
   - 名称
   - 描述
   - 代码（Python 代码）
3. 点击 "保存"

**测试要点**:
- ✅ 验证编辑表单是否正确填充
- ✅ 验证保存后数据是否正确更新
- ✅ 验证代码语法验证（如果有）

#### 2.4 启用/禁用策略

**步骤**:
1. 点击策略卡片上的电源按钮（Power/PowerOff 图标）
2. 或使用批量操作：
   - 勾选多个策略
   - 点击 "批量启用" 或 "批量禁用"

**测试要点**:
- ✅ 验证单个策略状态切换
- ✅ 验证批量操作是否生效
- ✅ 验证状态变化后列表是否正确刷新

#### 2.5 删除策略

**步骤**:
1. 点击策略卡片上的 "删除" 按钮
2. 确认删除操作
3. 策略从列表中移除

**测试要点**:
- ✅ 验证删除确认提示
- ✅ 验证删除后列表刷新
- ✅ 验证删除后相关数据是否清理

---

### 模块 3: 回测实验室

#### 3.1 配置回测参数

**步骤**:
1. 点击左侧导航栏 "回测实验室"
2. 选择策略：
   - 使用 "只显示激活策略" 筛选
   - 从下拉列表选择要回测的策略
3. 设置时间范围：
   - 开始日期
   - 结束日期
   - 或使用快捷选择（最近1年、6个月等）
4. 选择股票：
   - **方式1**: 使用股票池
     - 选择已创建的股票池
   - **方式2**: 手动输入
     - 输入股票代码，用逗号分隔（如 "AAPL,MSFT,GOOGL"）
5. 设置初始资金（默认 100,000）

**测试要点**:
- ✅ 验证策略选择是否正确
- ✅ 验证日期选择器是否可用
- ✅ 验证股票代码格式验证
- ✅ 验证初始资金输入验证（必须 > 0）

#### 3.2 运行回测

**步骤**:
1. 配置完所有参数后
2. 点击 "运行回测" 按钮
3. 等待回测完成（根据时间范围和股票数量，可能需要 30 秒到 5 分钟）
4. 查看回测结果

**测试要点**:
- ✅ 验证参数验证（缺少参数应提示错误）
- ✅ 验证回测过程是否有进度提示
- ✅ 验证回测结果是否正确显示
- ✅ 验证长时间回测是否超时

#### 3.3 查看回测结果

**回测结果包括**:

1. **关键指标**:
   - 总收益 (Total Return)
   - 年化收益 (Annualized Return)
   - 夏普比率 (Sharpe Ratio)
   - 最大回撤 (Max Drawdown)
   - 胜率 (Win Rate)

2. **图表**:
   - 资产曲线图（Portfolio Value Over Time）
   - 收益分布图（Return Distribution）
   - 交易记录表

3. **交易详情**:
   - 买入/卖出时间
   - 股票代码
   - 价格
   - 数量

**测试要点**:
- ✅ 验证所有指标是否正确计算
- ✅ 验证图表是否正确渲染
- ✅ 验证数据是否合理（如收益不应异常高）
- ✅ 验证交易记录是否完整

---

### 模块 4: AI 策略助手

#### 4.1 开始新会话

**步骤**:
1. 点击左侧导航栏 "AI策略助手"
2. 点击 "新建会话" 按钮
3. 系统会创建一个新会话并显示欢迎消息

**测试要点**:
- ✅ 验证新会话是否正确创建
- ✅ 验证欢迎消息是否显示

#### 4.2 与 AI 对话

**步骤**:
1. 在输入框中输入问题或请求，例如：
   - "帮我分析一下移动平均线策略的优缺点"
   - "如何优化我的策略参数？"
   - "解释一下 RSI 指标的计算方法"
2. 点击 "发送" 按钮或按 Enter 键
3. 等待 AI 回复（通常 5-15 秒）
4. 查看 AI 的回复

**测试要点**:
- ✅ 验证消息发送是否成功
- ✅ 验证 AI 回复是否及时
- ✅ 验证回复内容是否相关
- ✅ 验证代码块是否正确显示

#### 4.3 从对话中提取策略

**步骤**:
1. 在对话中，如果 AI 回复包含策略代码（包含 `def strategy_logic` 函数）
2. 代码块旁边会显示 "提取策略" 按钮（✂️ 图标）
3. 点击 "提取策略" 按钮
4. 系统自动提取策略代码
5. 提取成功后，策略会出现在右侧 "已提取策略" 列表中

**测试要点**:
- ✅ 验证提取按钮是否只在有策略代码时显示
- ✅ 验证提取过程是否有加载提示
- ✅ 验证提取成功后策略是否正确保存
- ✅ 验证提取失败时的错误提示

#### 4.4 保存提取的策略

**步骤**:
1. 在 "已提取策略" 列表中，找到要保存的策略
2. 点击策略卡片上的 "保存" 按钮
3. 填写策略信息：
   - 名称
   - 描述（可选）
   - 目标投资组合（可选）
4. 点击 "确认保存"
5. 策略会保存到策略库，可以在策略管理中查看

**测试要点**:
- ✅ 验证保存表单验证
- ✅ 验证保存成功后策略是否出现在策略管理
- ✅ 验证保存失败时的错误提示

#### 4.5 管理会话

**步骤**:
1. 在左侧会话列表中，可以：
   - 点击会话名称切换到该会话
   - 点击 "删除" 按钮删除会话
2. 会话历史会自动保存

**测试要点**:
- ✅ 验证会话切换是否正确
- ✅ 验证会话删除确认提示
- ✅ 验证会话历史是否正确保存

---

### 模块 5: 数据可视化（仪表板）

#### 5.1 查看投资组合概览

**步骤**:
1. 进入系统后，默认显示仪表板
2. 查看投资组合卡片，显示：
   - 总资产 (Total Value)
   - 现金 (Cash)
   - 今日盈亏 (Daily P&L)
   - 今日盈亏百分比

**测试要点**:
- ✅ 验证数据是否正确加载
- ✅ 验证数据格式是否正确（货币格式、百分比格式）
- ✅ 验证数据更新是否及时（每30秒自动刷新）

#### 5.2 查看持仓列表

**步骤**:
1. 在仪表板中，查看 "持仓" 区域
2. 查看持仓列表，每行显示：
   - 股票代码
   - 数量
   - 当前价格
   - 市值
   - 盈亏
   - 盈亏百分比

**测试要点**:
- ✅ 验证持仓列表是否正确显示
- ✅ 验证空持仓时的提示信息
- ✅ 验证价格更新是否及时

#### 5.3 查看市场数据

**步骤**:
1. 在仪表板中，查看 "市场概览" 区域
2. 查看多只股票的实时报价
3. 点击股票可以查看详细信息

**测试要点**:
- ✅ 验证市场数据是否正确加载
- ✅ 验证数据更新是否及时
- ✅ 验证数据加载失败时的错误处理

#### 5.4 查看技术指标

#### 5.5 切换视图模式

**步骤**:
1. 在数据可视化页面顶部，可以看到视图切换按钮（标签页）
2. 选择不同的视图：
   - **概览 (Overview)**: 显示投资组合和市场概览
     - 投资组合总览卡片
     - 持仓列表
     - 市场报价列表
     - 投资组合价值趋势图
   - **多股票 (Multi-Stock)**: 显示多只股票的对比图表
     - 多股票价格对比图
     - 涨跌幅对比
   - **技术指标 (Indicators)**: 显示选中股票的技术指标图表
     - 选择股票代码（默认 AAPL）
     - 显示 SMA、RSI、MACD 等技术指标图表
3. 在不同视图间切换，查看不同的数据展示

**测试要点**:
- ✅ 验证视图切换是否流畅
- ✅ 验证每个视图的数据是否正确显示
- ✅ 验证视图切换后数据是否正确刷新
- ✅ 验证技术指标视图中的股票选择功能

**步骤**:
1. 在仪表板中，选择要查看的股票（默认 AAPL）
2. 查看技术指标图表，包括：
   - SMA (简单移动平均线)
   - RSI (相对强弱指标)
   - MACD (指数平滑移动平均线)
3. 图表会自动更新

**测试要点**:
- ✅ 验证图表是否正确渲染
- ✅ 验证指标计算是否正确
- ✅ 验证图表响应式布局

---

### 模块 6: 股票池管理（在回测实验室中）

#### 6.1 创建股票池

**步骤**:
1. 在回测实验室中，点击 "股票池" 标签
2. 点击 "创建股票池" 按钮
3. 填写股票池信息：
   - 名称
   - 描述（可选）
4. 搜索并添加股票：
   - 在搜索框中输入股票代码或名称
   - 从搜索结果中选择股票
   - 点击 "添加" 按钮
5. 点击 "保存" 按钮

**测试要点**:
- ✅ 验证表单验证
- ✅ 验证股票搜索功能
- ✅ 验证股票添加功能
- ✅ 验证保存功能

#### 6.2 管理股票池

**步骤**:
1. 在股票池列表中，可以：
   - 点击股票池名称查看详情
   - 点击 "编辑" 按钮编辑股票池
   - 点击 "删除" 按钮删除股票池
2. 在股票池详情中，可以：
   - 添加更多股票
   - 移除股票

**测试要点**:
- ✅ 验证编辑功能
- ✅ 验证删除确认提示
- ✅ 验证股票添加/移除功能

---

## 测试要点

### 功能测试清单

#### 基础功能
- [ ] 页面加载是否正常
- [ ] 导航栏切换是否流畅
- [ ] 数据加载是否有加载提示
- [ ] 错误提示是否友好

#### AI 模型设置
- [ ] 添加模型功能
- [ ] 编辑模型功能
- [ ] 删除模型功能
- [ ] 测试连接功能
- [ ] 设置默认模型功能
- [ ] API Key 加密存储

#### 策略管理
- [ ] 策略列表加载
- [ ] 搜索功能
- [ ] 筛选功能
- [ ] 编辑策略
- [ ] 启用/禁用策略
- [ ] 批量操作
- [ ] 删除策略

#### AI 策略助手（包含策略生成）
- [ ] 创建会话
- [ ] 发送消息
- [ ] AI 回复
- [ ] 策略自动提取
- [ ] 保存提取的策略
- [ ] 会话管理
- [ ] AI 策略代码生成（通过对话）

#### 回测功能
- [ ] 参数配置
- [ ] 回测执行
- [ ] 结果展示
- [ ] 图表渲染
- [ ] 数据准确性

#### 数据可视化
- [ ] 投资组合数据加载
- [ ] 持仓列表显示
- [ ] 市场数据更新
- [ ] 技术指标图表
- [ ] 视图切换功能

#### 股票池管理
- [ ] 创建股票池
- [ ] 搜索股票
- [ ] 添加/移除股票
- [ ] 编辑股票池
- [ ] 删除股票池

### 性能测试

- [ ] 页面加载时间 < 3 秒
- [ ] API 响应时间 < 2 秒
- [ ] 回测执行时间合理
- [ ] 大量数据时的性能

### 兼容性测试

- [ ] Chrome 浏览器
- [ ] Firefox 浏览器
- [ ] Safari 浏览器
- [ ] Edge 浏览器
- [ ] 移动端浏览器（响应式）

### 错误处理测试

- [ ] 网络错误处理
- [ ] API 错误处理
- [ ] 数据验证错误
- [ ] 超时处理

---

## 常见问题

### Q1: 页面加载很慢怎么办？

**A**: 
- 检查网络连接
- 如果是生产环境，可能是服务冷启动（15分钟无请求后暂停），需要等待 30-60 秒
- 刷新页面重试

### Q2: AI 模型连接失败？

**A**:
- 检查 API Key 是否正确
- 检查网络连接
- 检查 API Key 是否有效（未过期、有余额）
- 查看错误提示信息

### Q3: 策略生成失败？

**A**:
- 检查是否已设置 AI 模型
- 检查 AI 模型是否可用（测试连接）
- 检查提示是否清晰
- 查看控制台错误信息

### Q4: 回测结果异常？

**A**:
- 检查策略代码是否正确
- 检查时间范围是否合理
- 检查股票代码是否正确
- 查看回测日志

### Q5: 无法提取策略？

**A**:
- 确保 AI 回复中包含 `def strategy_logic` 函数
- 确保代码格式正确（Python 代码块）
- 检查网络连接
- 查看错误提示

### Q6: 数据不更新？

**A**:
- 刷新页面
- 检查网络连接
- 检查后端服务是否正常运行
- 查看浏览器控制台错误

---

## 反馈渠道

如遇到问题或需要帮助，请：

1. **记录问题详情**:
   - 操作步骤
   - 预期结果
   - 实际结果
   - 错误信息（如有）
   - 截图（如有）

2. **反馈方式**:
   - 提交 Issue 到 GitHub
   - 联系开发团队
   - 发送邮件反馈

---

## 附录

### 支持的 AI 提供商

- **Gemini**: Google Gemini API
- **OpenAI**: OpenAI GPT 系列
- **Claude**: Anthropic Claude API
- **Custom**: 自定义 API 端点

### 支持的市场

- **美股**: 使用股票代码（如 AAPL, MSFT）
- **港股**: 使用股票代码（如 00700.HK）
- **A股**: 使用股票代码（如 000001.SZ）

### 技术指标说明

- **SMA**: 简单移动平均线
- **RSI**: 相对强弱指标（0-100，>70 超买，<30 超卖）
- **MACD**: 指数平滑移动平均线
- **BB**: 布林带

---

**文档版本**: 1.0  
**最后更新**: 2026-01-15  
**维护者**: TradeOpenBB 开发团队
